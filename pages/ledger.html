<html>
    <head>
        <style>
            button{color: green;background: white;border-radius: 0.2em;font-size: 20px;padding:4px;margin-left: 10px;margin: 5px;padding: 15px; border-radius: 10px;}
            h1{text-align: center;font-family: "Pacifico",cursive;}
            select{font-size: large;font-family: consolas;}
            table{width: 100%;margin: 20px 0;border-collapse: collapse;}
            table, th, td{border: 1px solid #cdcdcd;}
            table th, table td{padding: 5px;text-align: left;}
            td,th{font-size: x-large;font-family: "Consolas";}
            .credited{color:green}
            .debited{color:red}
        </style>
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>  
        <title>Ledger Page</title>
            <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
            <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
            <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
            <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-storage.js"></script>
            <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-firestore.js"></script>
            <script src="../js/index.js"></script>
            <script>
            function addListL(){
                firestore.collection("users/naresh/connections").get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    var select = document.getElementById("PartyNameL");
                    var option = document.createElement('option');
                    option.text = option.value = `${doc.id}`;
                    select.add(option, 0);
                    });
                });
            }
            // getting Receipt Records
            function showLedgerR(){
                var party=$("#PartyNameL").val();
                firestore.collection("/users/naresh/Reciept_Records").where("TO", "==", party)
                .get()
                .then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                    // console.log(doc.id, " => ", doc.data());
                    var myData = doc.data();
                    var markup = "<tr><td class=\"credited\"> ₹" + `${myData.AMOUNT}` + "</td><td>" + `${myData.FROM}` + "</td><td>" + `${myData.TO}` + "</td><td> Recipt Number: " + `${myData.Reciept_Number}` + "</td></tr>";
                    $("table").append(markup);
                    });
                })
                .catch(function(error) {
                    console.log("Error getting Reciept Records for this party: ", error);
                });
            }
            //getting Payment Records
            function showLedgerP(){
                var party=$("#PartyNameL").val();
                firestore.collection("/users/naresh/Payment_Records").where("FROM", "==", party)
                .get()
                .then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                    // console.log(doc.id, " => ", doc.data());
                    var myData = doc.data();
                    var markup = "<tr><td class=\"debited\"> ₹" + `${myData.AMOUNT}` + "</td><td>" + `${myData.TO}` + "</td><td>" + `${myData.FROM}` + "</td><td> Payment Number: " + `${myData.Payment_Number}` + "</td></tr>";
                    $("table").append(markup);
                    });
                })
                .catch(function(error) {
                    console.log("Error getting Payment Records for this party: ", error);
                });
            }
            //getting Ledger Records
            function showLedgerS(){
                var party=$("#PartyNameL").val();
                firestore.collection("/users/naresh/Sale_Records").where("SoldTo", "==", party)
                .get()
                .then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                    console.log(doc.id, " => ", doc.data());
                    });
                })
                .catch(function(error) {
                    console.log("Error getting Sale Records for this party: ", error);
                });
            }
            </script>
            
        <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    </head>
    <body onload="addListL()">
        <h1>Ledger: </h1>
            <div>
            <select id="PartyNameL" name="PartyNameL">
                <option>Choose the Name of the party</option>
            </select>
            <button type="button" onclick="showLedgerR(), showLedgerP(), showLedgerS()">View Ledger Entries</button><br>
                <a href="../MainPage.html"><button id="gotoMp" type="button">Go Back</button></a>
            </div>
            <table id="myTable">
                <tr>
                  <th>Amount</th>
                  <th>Wallet type</th>
                  <th>Party Name</th>
                  <th>Record Entry</th>
                </tr>

              </table>
        <script>
            firebase.auth().onAuthStateChanged(function(user)
            {
                if(!user)
                {
                    window.location.href="../signin.html";
                }
            });
        </script>
        </body>
</html>